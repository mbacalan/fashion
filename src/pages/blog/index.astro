---
import BlogLayout from "../../layouts/blog-layout.astro";

type PostMetadata = {
  title: string;
  description?: string;
  pubDate?: string | Date;
  tags?: string[];
  author?: string;
};

type MarkdownPost = {
  url: string;
  frontmatter: PostMetadata;
};

const importedPosts = Object.values(
  import.meta.glob<MarkdownPost>("./*.md", { eager: true }),
);

const posts = importedPosts
  .map((post) => {
    const rawDate = post.frontmatter.pubDate;
    const published =
      typeof rawDate === "string"
        ? new Date(rawDate)
        : rawDate
          ? new Date(rawDate)
          : undefined;

    return {
      ...post,
      published,
    };
  })
  .sort((a, b) => {
    const aTime = a.published?.getTime() ?? 0;
    const bTime = b.published?.getTime() ?? 0;
    return bTime - aTime;
  });

const formatDate = (date?: Date) =>
  date?.toLocaleDateString("en-US", {
    month: "long",
    day: "numeric",
    year: "numeric",
  });
---

<BlogLayout
  heroTag="Maison Journal"
  heroTitle="Behind the seams"
  heroDescription="Dispatches from fittings, ateliers, and backstage queues. Browse case studies, creative breakdowns, and styling notes we share with our favorite collaborators."
  heroAccent="Updated seasonally"
>
  {
    posts.length === 0 ? (
      <div class="border-brand-secondary-border rounded-3xl border border-dashed bg-white/60 px-8 py-16 text-center">
        <p class="text-brand-body text-lg font-medium">
          Our journal is being stitched together. Check back soon.
        </p>
      </div>
    ) : (
      posts.map((post) => (
        <article class="group border-brand-secondary-border overflow-hidden rounded-3xl border bg-white/70 shadow-[0_20px_45px_rgba(94,101,255,0.08)] transition hover:-translate-y-1 hover:shadow-[0_28px_65px_rgba(94,101,255,0.15)]">
          <a href={post.url} class="flex h-full flex-col gap-6 px-8 py-10">
            <div class="text-brand-secondary-ink flex flex-wrap items-center gap-4 text-xs font-semibold tracking-[0.35em] uppercase">
              {post.published && (
                <span class="bg-brand-secondary-wash text-brand-secondary rounded-full px-4 py-2">
                  {formatDate(post.published)}
                </span>
              )}
              <span class="text-brand-body">
                {post.frontmatter.author ?? "Maison Atelier Team"}
              </span>
            </div>
            <div class="space-y-4">
              <h2 class="group-hover:text-brand-primary text-2xl font-semibold tracking-tight text-neutral-950 transition-colors">
                {post.frontmatter.title}
              </h2>
              {post.frontmatter.description && (
                <p class="text-brand-body text-base leading-relaxed">
                  {post.frontmatter.description}
                </p>
              )}
            </div>
            {post.frontmatter.tags?.length ? (
              <ul class="text-brand-secondary-ink flex flex-wrap gap-2 text-[0.7rem] font-semibold tracking-[0.35em] uppercase">
                {post.frontmatter.tags.map((tag) => (
                  <li class="bg-brand-secondary-soft text-brand-secondary rounded-full px-4 py-1">
                    {tag}
                  </li>
                ))}
              </ul>
            ) : null}
            <span class="text-brand-primary mt-auto inline-flex items-center gap-3 text-sm font-semibold tracking-[0.35em] uppercase">
              Read story
              <svg
                class="size-4"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5 12h14m0 0-5-5m5 5-5 5"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
          </a>
        </article>
      ))
    )
  }
</BlogLayout>
